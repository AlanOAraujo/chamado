<!DOCTYPE html>

<html lang="pt-br">
	<head>
	
		<meta charset="UTF-8">
		<title>Perfil</title>
		<link rel="stylesheet" href="../css/bootstrap.min.css">
		<link rel="stylesheet" href="../css/pagga.css">
	
	</head>
	<body>
		<main class="container">
	
			<h1>Perfil</h1>
	
			<div id="datatb-wrapper" class="dataTables_wrapper dt-bootstrap4">
	
				<div class="form-group">
					<label for="datatb-search">Pesquisar:</label>
					
					<div class="input-group">
						<input id="datatb-search" onkeyup="pesquisaTable()" type="search" class="form-control"
						aria-controls="datatb">
						<button class="btn btn-outline-primary">Buscar</button>
					</div>
					
				</div>
	
				<div id="div-datatb" class="table-responsive">
	
					<table id="datatb" class="table table-striped table-sm table-bordered text-center">
						<thead>
							<tr>
								<th class="datatb-th" aria-controls="datatb">Código</th>
								<th class="datatb-th" aria-controls="datatb">Descrição</th>
								<th class="datatb-th" aria-controls="datatb">Editar</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>1</td>
								<td>Teste</td>
								<td>
									<a class="btn btn-light btn-editar btn-sm" href="perfil-novo.html">Editar</a>
								</td>
							</tr>
						</tbody>
					</table>
	
				</div>
	
			</div>
			<div class="float-left">
				<a id="botao-sync" class="btn btn-outline-info">Sincronizar</a>
            </div>
            
			<div class="float-right">
				<a href="perfil-novo.html" id="btn-novoperfil" class="btn btn-primary">Novo Perfil</a>
			</div>
	
		</main>
	
		<script type="text/javascript" src="../js/jquery.js"></script>
		<script type="text/javascript" src="../js/pagga.js"></script>
		
		
		<script type="text/javascript">
		
			$(document).ready(function(){
				$('#botao-sync').click(function(e){
					e.preventDefault();
					
					Pagga.perfil.lista()
						.done(function(jqXHR){
							let perfils = Object.keys(jqXHR.perfis);
							
							perfils.forEach(function(perfil){
									console.log(perfil);
						            var linhas = novaLinha(perfil.id, perfil.descricao);
						            $("tbody").append(linhas);
							})
						})
						.fail(function(jqXHR, textStatus, errorThrown){
							var error = JSON.parse(jqXHR.responseText);
							$('#message').text(error.message);
							$('#message').removeClass('hide');
							$('#message').addClass('alert-danger');
							$('#message').addClass('alert-dismissible');
						});
					
				})
			});
				
			function novaLinha(codigo, descricao){
				var linha = $("<tr>");
			    var colunaCodigo = $("<td>").text(codigo);
			    var colunaDescricao = $("<td>").text(descricao);
			    var colunaEditar = $("<td>");
			    
			    var link = $("<a>").text('Editar').attr("href","perfil-novo.html").addClass("btn btn-light btn-editar btn-sm");
			    
			    colunaEditar.append(link);
			    
			    linha.append(colunaCodigo);
			    linha.append(colunaDescricao);
			    linha.append(colunaEditar);

			    return linha;
			}
			
			
			function sincronizarPerfil(){
				$.get("../perfil",function(data){
			        $(data).each(function(){
			            var linhas = novaLinha(this.codigo, this.descricao);
			            $("tbody").append(linhas);
			        })
			    });

			}
			
			
		
		</script>
		
	</body>
</html>