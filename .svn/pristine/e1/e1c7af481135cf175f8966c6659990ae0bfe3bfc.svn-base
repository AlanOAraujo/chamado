<!DOCTYPE html>

<html>
	<head>
		<meta charset='UTF-8'>
		<title>Chamado</title>
		<link rel="stylesheet" href="../css/pagga.css?version=12">
		<link rel="stylesheet" href="../css/bootstrap.min.css">
		<link rel="stylesheet" href="../css/jquery.dataTables.min.css">
	</head>
	<body>
		
		<form id="formChamados">
		
			<section>			
				<div class="container">
					<div class="row">
					
						<div class="col-sm-6">
						
							<h1>Indicadores</h1>
						
						</div>
					
						<div class="col-sm">
							<div id="div-search-chm" class="input-group mb-3 input-search-chm">
								<input id="input-search-ticket" type="text" class="form-control" aria-describedby="btn-ticket-search">
								
								<div class="input-group-append">
									<button class="btn btn-outline-secondary" type="button" id="btn-ticket-search">Ticket</button>
								</div>
							</div>
							
						</div>
					</div>
				</div>	
			</section>
			
			<section class="chm-tabelas">
			
				<div class="container">
					<div class="row">
						<div id="div-chmtb-aberto" class="table-responsive col-sm">
							<label for="chmtb-aberto"><strong>Resumo de Tickets abertos</strong></label>
							
							<table id="chmtb-aberto" class="table table-striped table-sm table-bordered text-center">
								
								<thead>
									<tr>
										<th class="chmtb-aberto-th" aria-controls="chmtb-aberto">Código</th>
										<th class="chmtb-aberto-th" aria-controls="chmtb-aberto">Usuário</th>
										<th class="chmtb-aberto-th" aria-controls="chmtb-aberto">Tipo</th>
										<th class="chmtb-aberto-th" aria-controls="chmtb-aberto">Data</th>
										<th class="chmtb-aberto-th" aria-controls="chmtb-aberto">Status</th>
									</tr>
								</thead>
							
							</table>
						
						</div>
						
						<div id="div-chmtb-andamento" class="table-responsive col-sm">
							<label for="chmtb-andamento"><strong>Resumo de Tickets em atendimento</strong></label>
							
							<table id="chmtb-andamento" class="table table-striped table-sm table-bordered text-center">
								
								<thead>
									<tr>
										<th class="chmtb-andamento-th" aria-controls="chmtb-andamento">Código</th>
										<th class="chmtb-andamento-th" aria-controls="chmtb-andamento">Usuário</th>
										<th class="chmtb-andamento-th" aria-controls="chmtb-andamento">Tipo</th>
										<th class="chmtb-andamento-th" aria-controls="chmtb-andamento">Previsão</th>
										<th class="chmtb-andamento-th" aria-controls="chmtb-andamento">Status</th>
									</tr>
								</thead>
							</table>
				
						</div>
						
					</div>
				</div>
				
				
				<div class="container">
					<div class="row">
						
						<div id="div-chmtb-historico" class="table-responsive col-sm">
							<label for="chmtb-historico"><strong>Histórico de tickets</strong></label>
							
							<table id="chmtb-historico" class="table table-striped table-sm table-bordered text-center">
								
								<thead>
									<tr>
										<th class="chmtb-historico-th" aria-controls="chmtb-historico">Cód.Ticket</th>
										<th class="chmtb-historico-th" aria-controls="chmtb-historico">Usuário</th>
										<th class="chmtb-historico-th" aria-controls="chmtb-historico">Título</th>
										<th class="chmtb-historico-th" aria-controls="chmtb-historico">Data</th>
										<th class="chmtb-historico-th" aria-controls="chmtb-historico">Status</th>
									</tr>
								</thead>
							
							</table>
				
						</div>
					
						<div id="div-chmtb-finalizado" class="table-responsive col-sm">
							<label for="chmtb-finalizado"><strong>Resumo de Tickets fechado</strong></label>
							
							<table id="chmtb-finalizado" class="table table-striped table-sm table-bordered text-center">
								
								<thead>
									<tr>
										<th class="chmtb-finalizado-th" aria-controls="chmtb-finalizado">Código</th>
										<th class="chmtb-finalizado-th" aria-controls="chmtb-finalizado">Tipo</th>
										<th class="chmtb-finalizado-th" aria-controls="chmtb-finalizado">Fechado Por</th>
										<th class="chmtb-finalizado-th" aria-controls="chmtb-finalizado">Data finalizado</th>
										<th class="chmtb-finalizado-th" aria-controls="chmtb-finalizado">Status</th>
									</tr>
								</thead>
							
							</table>
				
						</div>
						
					</div>
				</div>
			</section>
		
		</form>
		
		<script type="text/javascript" src="../js/jquery.js"></script>
		<script type="text/javascript" src="../js/pagga.js"></script>
		<script type="text/javascript" src="../js/jquery.dataTables.min.js"></script>
		<script type="text/javascript" src="../js/bootstrap.min.js"></script>
		
		<script type="text/javascript">
			$(document).ready(function() {
				
				$('#formChamados').on("keypress", function(e) {
					if ((e.keyCode == 10)||(e.keyCode == 13)) {
				    	e.preventDefault();
			        }
			    });
				
				var filtro;
				
				$.fn.dataTable.ext.errMode = 'none';
				
				var tabelaAberto = $('#chmtb-aberto').DataTable({
					"searching": false,
					"lengthChange": false,
					"responsive": true,
					"processing": true,
			        "serverSide": true,
			        "pageLength": 4,
			        "info": true,
			        "pagingType": 'full',
			        "language": {
			        	"zeroRecords": "Pesquisa não encontrada com status aberto",
			        	"emptyTable": "Não á registros de tickets abertos",
			        	"info": "Mostrando _START_ de _END_ com _TOTAL_ total",
			            "paginate": {
			            	"first": "Primeiro",
			            	"last": "Último",
			                "previous": '‹',
			                "next":     '›'
			            }
			        },
			        "ajax": {
			        	"url" : '../chamado/paginacao',
			        	"datatype": "json",
			        	"data": function ( d ) {
			        	     return $.extend( {}, d, {
			        	       "status": "ABERTO",
			        	       "filtro": filtro
			        	     } );
			        	   }
			        },
			        "columnDefs": [
			            { 
			            	"targets": [0],
			            	"data": function(data){
			                    return '<a href="../html/historico.html?id='+data.id+'">'+data.id+'</a>';
			            	}    
						},
						{ 
			            	"targets": [1],
			            	"data": function(data){
			            		return data.usuario.nome;
			                }
						},
						{ 
			            	"targets": [2],
			            	"data": "tipo" 
						},
						{ 
			            	"targets": [3],
			            	"data": "data" 
						},
						{ 
			            	"targets": [4],
			            	"data": "status" 
						}
			          ]
				});
				
				var tabelaAtendimento = $('#chmtb-andamento').DataTable({
					"searching": false,
					"lengthChange": false,
					"responsive": true,
					"processing": true,
			        "serverSide": true,
			        "pageLength": 4,
			        "info": true,
			        "pagingType": 'full',
			        "language": {
			        	"zeroRecords": "Pesquisa não encontrada com status em atendimento",
			        	"emptyTable": "Não á registros de tickets em atendimento",
			        	"info": "Mostrando _START_ de _END_ com _TOTAL_ total",
			            "paginate": {
			            	"first": "Primeiro",
			            	"last": "Último",
			                "previous": '‹',
			                "next":     '›'
			            }
			        },
			        "ajax": {
			        	"url" : '../chamado/paginacao',
			        	"datatype": "json",
			        	"data": function ( d ) {
			        	     return $.extend( {}, d, {
			        	       "status": "EM_ATENDIMENTO",
			        	       "filtro": filtro
			        	     } );
			        	   }
			        },
			        "columnDefs": [
			            { 
			            	"targets": [0],
			            	"data": function(data){
			                    return '<a href="../html/historico.html?id='+data.id+'">'+data.id+'</a>';
			            	}    
						},
						{ 
			            	"targets": [1],
			            	"data": function(data){
			            		return data.usuario.nome;
			                }
						},
						{ 
			            	"targets": [2],
			            	"data": "tipo" 
						},
						{ 
			            	"targets": [3],
			            	"data": "dataPrevisao" 
						},
						{ 
			            	"targets": [4],
			            	"data": "status" 
						}
			          ]
				});
				
				var tabelaFinalizado = $('#chmtb-finalizado').DataTable({
					"searching": false,
					"lengthChange": false,
					"responsive": true,
					"processing": true,
			        "serverSide": true,
			        "pageLength": 4,
			        "info": true,
			        "pagingType": 'full',
			        "language": {
			        	"zeroRecords": "Pesquisa não encontrada com status fechado",
			        	"emptyTable": "Não á registros de tickets fechados",
			        	"info": "Mostrando _START_ de _END_ com _TOTAL_ total",
			            "paginate": {
			            	"first": "Primeiro",
			            	"last": "Último",
			                "previous": '‹',
			                "next":     '›'
			            }
			        },
			        "ajax": {
			        	"url" : '../chamado/paginacao',
			        	"datatype": "json",
			        	"data": function ( d ) {
			        	     return $.extend( {}, d, {
			        	    	 "status": "FECHADO",
			        	    	 "filtro": filtro
			        	     } );
			        	   }
			        },
			        "columnDefs": [
			            { 
			            	"targets": [0],
			            	"data": function(data){
			                    return '<a href="../html/historico.html?id='+data.id+'">'+data.id+'</a>';
			            	}    
						},
						{ 
			            	"targets": [1],
			            	"data": "tipo"
						},
						{ 
			            	"targets": [2],
			            	"data": function(data){
			            		return data.usuarioFechamento.nome;
			                }
						},
						{ 
			            	"targets": [3],
			            	"data": "dataFechamento" 
						},
						{ 
			            	"targets": [4],
			            	"data": "status" 
						}
			          ]
				});
				
				var tabelaHistorico = $('#chmtb-historico').DataTable({
					"searching": false,
					"lengthChange": false,
					"responsive": true,
					"processing": true,
			        "serverSide": true,
			        "pageLength": 4,
			        "info": true,
			        "pagingType": 'full',
			        "language": {
			        	"emptyTable": "Não á registro de histórico",
			        	"info": "Mostrando _START_ de _END_ com _TOTAL_ total",
			            "paginate": {
			            	"first": "Primeiro",
			            	"last": "Último",
			                "previous": '‹',
			                "next":     '›'
			            }
			        },
			        "ajax": {
			        	"url" : '../chamado/paginacao/historico',
			        	"datatype": "json",
			        },
			        "columnDefs": [
			            { 
			            	"targets": [0],
			            	"data": function(data){
			                    return '<a href="../html/historico.html?id='+data.chamadoid+'">'+data.chamadoid+'</a>';
			            	}    
						},
						{ 
			            	"targets": [1],
			            	"data": function(data){
			                    var json = data.usuario;
			                    return json; 
			                }
						},
						{ 
			            	"targets": [2],
			            	"data": function(data){
			                    var json = data.titulo;
			                    return  json.length > 9 ? json.substr( 0, 9 ) + '…' : json;
			                }
						},
						{ 
			            	"targets": [3],
			            	"data": "datacomentario" 
						},
						{ 
			            	"targets": [4],
			            	"data": "status" 
						}
			          ]
				});
				
			    $('#btn-ticket-search').on('click', function(event){
					event.preventDefault();
					
					filtro = $('#input-search-ticket').val();
					tabelaAberto.ajax.reload(); 
					tabelaAtendimento.ajax.reload();
					tabelaFinalizado.ajax.reload();
				});
			    
			});
			
			function exibeMensagem(msg, sucesso){
				if(sucesso) {
					mostraDialogo('#message', 3000);
					$('#message').text(msg);
					$('#message').removeClass('hide');
					$('#message').addClass('alert');
					$('#message').addClass('alert-success');
					$('#message').addClass('alert-dismissible');
				} else {
					mostraDialogo('#message', 3000);
					$('#message').text(msg);
					$('#message').removeClass('hide');
					$('#message').addClass('alert');
					$('#message').addClass('alert-danger');
					$('#message').addClass('alert-dismissible');
				}
			}
			
			function mostraDialogo(mensagem, tempo){
				
			    $('#message').stop().fadeTo(1, 1).removeClass('hidden');
			    
			    setTimeout(function() {
			        $('#message').fadeTo(300, 0).slideUp(300, function(){
			        	$('#message').text('').addClass('hidden');
			        });
			    }, tempo);
	
			}
		</script>
	
	</body>
</html>